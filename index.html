<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Arum - AI Chatbot</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'dark-bg': '#111827',
            'dark-secondary': '#1f2937',
            'text-light': '#f0fdfa',
            'text-gray': '#9ca3af',
            'accent': '#2dd4bf',
            'accent-dark': '#0d9488'
          },
          fontFamily: {
            serif: ['DM Serif Display', 'serif'],
            sans: ['Plus Jakarta Sans', 'sans-serif']
          }
        }
      }
    };
  </script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.6.0/css/all.css">
  
  <style>
    body {
      @apply bg-dark-bg text-text-light font-sans;
    }
    .chat-container {
      @apply flex flex-col h-screen w-full max-w-2xl mx-auto shadow-xl rounded-lg overflow-hidden border border-dark-secondary;
    }
    .chat-header {
      @apply bg-dark-secondary p-5 text-lg font-semibold flex items-center justify-between;
    }
    .chat-body {
      @apply flex-1 overflow-y-auto p-5 space-y-4;
    }
    .chat-footer {
      @apply p-4 bg-dark-secondary flex items-center gap-3;
    }
    .chat-input {
      @apply flex-1 bg-dark-secondary border border-text-gray p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent;
    }
    .chat-send {
      @apply bg-accent text-dark-bg p-3 rounded-full transition-all hover:bg-accent-dark;
    }
    .chat-message {
      @apply p-3 rounded-lg max-w-xs;
    }
    .chat-message.user {
      @apply bg-white text-dark-bg self-end;
    }
    .chat-message.bot {
      @apply bg-accent text-dark-bg self-start;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <span>Arum - AI Chatbot</span>
    </div>
    <div class="chat-body" id="chat-body"></div>
    <form id="chat-form" class="chat-footer">
      <textarea id="chat-input" class="chat-input" placeholder="Tanyakan sesuatu..." rows="1"></textarea>
      <button type="submit" class="chat-send" disabled>
        <i class="fa-solid fa-paper-plane"></i>
      </button>
    </form>
  </div>

  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
  <script>
    $(document).ready(function() {
      let isLoading = false;

      $("#chat-input").on("input", function () {
        $(".chat-send").prop("disabled", $(this).val().trim() === "" || isLoading);
      });

      $("#chat-form").submit(function (e) {
        e.preventDefault();
        var message = $("#chat-input").val().trim();
        if (message === "" || isLoading) return;

        isLoading = true;
        $(".chat-send").prop("disabled", true);

        $("#chat-body").append("<div class='chat-message user'>" + message.replace(/\n/g, "<br>") + "</div>");
        $("#chat-input").val("");
        scrollChatToBottom();

        var $botMsg = $("<div class='chat-message bot'>").html("<span class='loading'><span>.</span><span>.</span><span>.</span></span>");
        $("#chat-body").append($botMsg);
        scrollChatToBottom();

        $.ajax({
          type: "POST",
          url: "https://gemininodejsaspri-production.up.railway.app/chat",
          contentType: "application/json",
          data: JSON.stringify({ chat: message, history: [] }),
          xhrFields: { withCredentials: true },
          success: function (data) {
            isLoading = false;
            $(".chat-send").prop("disabled", $("#chat-input").val().trim() === "");
            $botMsg.html(data.response.trim().replace(/\n/g, "<br>"));
            scrollChatToBottom();
          },
          error: function () {
            isLoading = false;
            $(".chat-send").prop("disabled", $("#chat-input").val().trim() === "");
            $botMsg.html("Maaf, terjadi kesalahan.");
            scrollChatToBottom();
          }
        });
      });

      function scrollChatToBottom() {
        $("#chat-body").scrollTop($("#chat-body")[0].scrollHeight);
      }
    });
  </script>
</body>
</html>
