<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Arum - AI Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.6.0/css/all.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'dark-bg': '#111827',
            'dark-secondary': '#1f2937',
            'text-light': '#f0fdfa',
            'text-gray': '#9ca3af',
            'accent': '#2dd4bf',
            'accent-dark': '#0d9488'
          },
          fontFamily: {
            serif: ['DM Serif Display', 'serif'],
            sans: ['Plus Jakarta Sans', 'sans-serif']
          },
          keyframes: {
            'fade-in-up': {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            'fade-in': {
                '0%': { opacity: 0; },
                '100%': { opacity: 1; },
            },
             'dot-bounce': {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-5px)' },
            },
          },
          animation: {
            'fade-in-up': 'fade-in-up 0.3s ease-out',
            'fade-in': 'fade-in 0.5s ease-in-out',
             'dot-bounce': 'dot-bounce 1.2s infinite ease-in-out',
          },
          boxShadow: {
            'soft': '0 2px 4px 0 rgba(0,0,0,0.1)',
            'soft-lg': '0 4px 8px 0 rgba(0,0,0,0.15)',
            'input-focus': '0 0 0 3px rgba(45, 212, 191, 0.5)',
          }
        }
      }
    }
  </script>
  <style>
    :root {
      --vh: 1vh;
    }

    body, html {
      height: 100%;
      margin: 0;
      overflow: hidden;
      font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: #111827;
      color: #f0fdfa;
    }

    .chat-container {
      display: flex;
      flex-direction: column;
      height: calc(var(--vh, 1vh) * 100);
      overflow: hidden;
      animation: fade-in 0.4s ease;
    }

    .chat-header {
      background-color: #1f2937;
      padding: 1rem 1.5rem;
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      font-family: 'DM Serif Display', serif;
      flex-shrink: 0;
      border-bottom: 1px solid #374151;
      box-shadow: var(--tw-shadow-soft);
    }

    .chat-body {
        flex-grow: 1;
        overflow-y: auto;
        padding: 1.25rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        &::-webkit-scrollbar {
            width: 8px;
            background-color: transparent;
        }
        &::-webkit-scrollbar-thumb {
            background-color: #374151;
            border-radius: 4px;
             &:hover { background-color: #4b5563; }
        }
        scrollbar-width: thin;
        scrollbar-color: #374151 transparent;
    }


    .chat-footer {
      padding: 0.75rem 1rem;
      background-color: #1f2937;
      display: flex;
      gap: 0.75rem;
      flex-shrink: 0;
      align-items: center;
      border-top: 1px solid #374151;
    }

    .chat-input {
        flex-grow: 1;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        border: none;
        font-size: 1rem;
        background-color: #2d3748;
        color: #f0fdfa;
        transition: box-shadow 0.2s ease, background-color 0.2s ease;
        resize: none;
        overflow-y: hidden;
        max-height: 10rem;
        box-shadow: var(--tw-shadow-soft);
        &:focus {
            outline: none;
            box-shadow: var(--tw-shadow-input-focus), var(--tw-shadow-soft-lg);
            background-color: #4b5563;
        }
        &::placeholder { color: #9ca3af; }
    }

    .chat-send {
      background-color: transparent;
      border: none;
      color: white;
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: color 0.2s ease, transform 0.1s ease, background-color 0.2s ease;

      &:hover {
          background-color: #2dd4bf;
          color: #111827;
          transform: scale(1.05);
      }
      &:disabled {
        background-color: transparent;
        color: #9ca3af;
        cursor: not-allowed;
        transform: none;
      }
       i {
            transition: transform 0.2s ease;
        }
      &:hover i {
        transform: translateY(-2px);
      }

    }

    .chat-message {
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      font-size: 0.9375rem;
      line-height: 1.6;
      word-break: break-word;
      max-width: 85%;
      box-shadow: var(--tw-shadow-soft);
      animation: fade-in-up 0.2s ease;
      margin-bottom: 0.25rem;
    }
    .chat-message.user {
      background-color: #ffffff;
      color: #111827;
      align-self: flex-end;
      border-bottom-right-radius: 0.25rem;
    }
    .chat-message.bot {
      background-color: #2dd4bf;
      color: #111827;
      align-self: flex-start;
      border-bottom-left-radius: 0.25rem;
    }
    .chat-message.bot ul, .chat-message.bot ol {
      list-style-position: inside;
      padding-left: 0;
      margin: 0 0 0.5rem 0;
      margin-bottom: 0;
    }
    .chat-message.bot .loading {
      display: inline-flex;
      align-items: center;
    }
    .chat-message.bot .loading span {
      display: inline-block;
      margin: 0 2px;
       animation: dot-bounce 1.2s infinite ease-in-out;
    }
    .chat-message.bot .loading span:nth-child(1) { animation-delay: 0s; }
    .chat-message.bot .loading span:nth-child(2) { animation-delay: 0.2s; }
    .chat-message.bot .loading span:nth-child(3) { animation-delay: 0.4s; }

    @media (max-width: 640px) {
        .chat-header { padding: 0.75rem 1rem; font-size: 1.125rem; }
        .chat-message { max-width: 90%; }
        .chat-footer { padding: 0.5rem; }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <span>S E R A</span>
    </div>
    <div class="chat-body" id="chat-body">
    </div>
    <form id="chat-form" class="chat-footer">
      <textarea id="chat-input" class="chat-input" placeholder="Tanyakan sesuatu..." autocomplete="off" rows="1"></textarea>
      <button type="submit" class="chat-send" disabled>
        <i class="fa-solid fa-arrow-up"></i>
      </button>
    </form>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
    function setVh() {
      let vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    setVh();
    window.addEventListener('resize', setVh);

    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    $(document).ready(function() {
      let isLoading = false;

      $("#chat-input").on("input", function () {
        const inputVal = $(this).val().trim();
        $(".chat-send").prop("disabled", inputVal === "" || isLoading);
      });

      $("#chat-input").on("keydown", function(e) {
        if (!isMobile) {
          if (e.key === "Enter" && e.shiftKey) {
            return;
          } else if (e.key === "Enter") {
            e.preventDefault();
            $("#chat-form").submit();
          }
        }
      });

      $("#chat-form").submit(function (e) {
        e.preventDefault();
        var message = $("#chat-input").val().trim();
        if (message === "" || isLoading) return;

        isLoading = true;
        $(".chat-send").prop("disabled", true);

        $("#chat-body").append("<div class='chat-message user'>" + message.replace(/\n/g, "<br>") + "</div>");
        $("#chat-input").val("");
        adjustTextArea();
        scrollChatToBottom();

        var $botMsg = $("<div class='chat-message bot'>").html("<span class='loading'><span>.</span><span>.</span><span>.</span></span>");
        $("#chat-body").append($botMsg);
        scrollChatToBottom();

        $.ajax({
          type: "POST",
          url: "https://gemininodejsaspri-production.up.railway.app/chat",
          contentType: "application/json",
          data: JSON.stringify({ chat: message, history: [] }),
          xhrFields: { withCredentials: true },
          success: function (data) {
            isLoading = false;
            $(".chat-send").prop("disabled", $("#chat-input").val().trim() === "");
            $botMsg.html(data.response.trim().replace(/\n/g, "<br>"));
            scrollChatToBottom();
          },
          error: function (error) {
            isLoading = false;
            $(".chat-send").prop("disabled", $("#chat-input").val().trim() === "");
            $botMsg.html("Maaf, terjadi kesalahan.");
            scrollChatToBottom();
          }
        });
      });

      function scrollChatToBottom() {
        $("#chat-body").scrollTop($("#chat-body")[0].scrollHeight);
      }

      function adjustTextArea() {
        const $input = $("#chat-input");
        $input.css("height", "auto");
        const newHeight = $input[0].scrollHeight;
        const maxHeight = parseInt($input.css("max-height"), 10);
        if(newHeight > maxHeight) {
          $input.css("height", maxHeight + "px");
          $input.css("overflow-y", "auto");
        } else {
          $input.css("height", newHeight + "px");
          $input.css("overflow-y", "hidden");
        }
      }

      $("#chat-input").on("input", adjustTextArea);
    });
  </script>
</body>
</html>
