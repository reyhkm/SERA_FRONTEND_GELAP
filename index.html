<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Arum - AI Chatbot</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'dark-bg': '#111827',
            'dark-secondary': '#1f2937',
            'text-light': '#f0fdfa',
            'text-gray': '#9ca3af',
            'accent': '#2dd4bf',
            'accent-dark': '#0d9488'
          },
          fontFamily: {
            serif: ['DM Serif Display', 'serif'],
            sans: ['Plus Jakarta Sans', 'sans-serif']
          }
        }
      }
    }
  </script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.6.0/css/all.css">
  
  <style>
    /* Atur tinggi viewport dinamis */
    :root {
      --vh: 1vh;
    }
    /* Custom scrollbar untuk chat-body */
    .chat-body::-webkit-scrollbar {
      width: 10px;
    }
    .chat-body::-webkit-scrollbar-thumb {
      background-color: #374151;
      border-radius: 5px;
    }
  </style>
</head>
<body class="bg-dark-bg text-text-light font-sans">
  <div class="chat-container flex flex-col h-screen overflow-hidden max-w-2xl mx-auto shadow-xl rounded-lg border border-dark-secondary">
    <!-- Chat Header -->
    <div class="chat-header bg-dark-secondary p-5 text-lg font-semibold flex items-center justify-between border-b border-gray-700">
      <span>Arum - AI Chatbot</span>
    </div>
    <!-- Chat Body -->
    <div id="chat-body" class="chat-body flex-grow p-5 space-y-4 overflow-y-auto scroll-smooth"></div>
    <!-- Chat Footer -->
    <form id="chat-form" class="chat-footer bg-dark-secondary p-4 flex items-center gap-3">
      <textarea id="chat-input" class="chat-input flex-1 bg-dark-secondary border border-text-gray p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent transition-all resize-none overflow-hidden max-h-40" placeholder="Tanyakan sesuatu..." autocomplete="off" rows="1"></textarea>
      <button type="submit" class="chat-send bg-accent text-dark-bg p-3 rounded-full transition-all hover:bg-accent-dark disabled:text-text-gray disabled:cursor-not-allowed" disabled>
        <i class="fa-solid fa-paper-plane"></i>
      </button>
    </form>
  </div>

  <!-- JavaScript menggunakan Vanilla JS -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Atur tinggi viewport untuk perangkat mobile
      function setVh() {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty("--vh", `${vh}px`);
      }
      setVh();
      window.addEventListener("resize", setVh);

      const chatInput = document.getElementById("chat-input");
      const chatSend = document.querySelector(".chat-send");
      const chatBody = document.getElementById("chat-body");
      const chatForm = document.getElementById("chat-form");
      let isLoading = false;
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

      // Update status tombol kirim
      function updateSendButton() {
        chatSend.disabled = chatInput.value.trim() === "" || isLoading;
      }

      // Atur tinggi textarea secara dinamis
      function adjustTextArea() {
        chatInput.style.height = "auto";
        const newHeight = chatInput.scrollHeight;
        const maxHeight = 150; // px
        if (newHeight > maxHeight) {
          chatInput.style.height = `${maxHeight}px`;
          chatInput.style.overflowY = "auto";
        } else {
          chatInput.style.height = `${newHeight}px`;
          chatInput.style.overflowY = "hidden";
        }
      }

      chatInput.addEventListener("input", () => {
        updateSendButton();
        adjustTextArea();
      });

      // Tangani penekanan tombol Enter (tanpa shift untuk submit di desktop)
      chatInput.addEventListener("keydown", (e) => {
        if (!isMobile && e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          chatForm.dispatchEvent(new Event("submit", { cancelable: true }));
        }
      });

      // Tangani pengiriman pesan
      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = chatInput.value.trim();
        if (message === "" || isLoading) return;
        isLoading = true;
        updateSendButton();

        // Tambahkan pesan pengguna ke chat-body
        const userMsg = document.createElement("div");
        userMsg.className = "chat-message user self-end bg-white text-dark-bg px-4 py-2 rounded-lg shadow-md";
        userMsg.innerHTML = message.replace(/\n/g, "<br>");
        chatBody.appendChild(userMsg);
        scrollChatToBottom();
        chatInput.value = "";
        adjustTextArea();

        // Tambahkan pesan bot dengan loading animation
        const botMsg = document.createElement("div");
        botMsg.className = "chat-message bot self-start bg-accent text-dark-bg px-4 py-2 rounded-lg shadow-md";
        botMsg.innerHTML = `
          <span class="loading flex gap-1">
            <span class="block animate-bounce" style="animation-delay: 0s;">.</span>
            <span class="block animate-bounce" style="animation-delay: 0.2s;">.</span>
            <span class="block animate-bounce" style="animation-delay: 0.4s;">.</span>
          </span>`;
        chatBody.appendChild(botMsg);
        scrollChatToBottom();

        // Kirim pesan menggunakan fetch (AJAX)
        try {
          const response = await fetch("https://gemininodejsaspri-production.up.railway.app/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            credentials: "include",
            body: JSON.stringify({ chat: message, history: [] })
          });
          if (!response.ok) throw new Error("Network response not ok");
          const data = await response.json();
          botMsg.innerHTML = data.response.trim().replace(/\n/g, "<br>");
        } catch (error) {
          botMsg.innerHTML = "Maaf, terjadi kesalahan.";
        }
        isLoading = false;
        updateSendButton();
        scrollChatToBottom();
      });

      // Fungsi scroll chat-body ke bawah dengan smooth
      function scrollChatToBottom() {
        chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: "smooth" });
      }
    });
  </script>
</body>
</html>
