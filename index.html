<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Arum - AI Chatbot</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'dark-bg': '#0f172a',
            'dark-secondary': '#1e293b',
            'text-light': '#e2e8f0',
            'text-gray': '#94a3b8',
            'accent': '#38bdf8',
            'accent-dark': '#0284c7'
          },
          fontFamily: {
            serif: ['DM Serif Display', 'serif'],
            sans: ['Inter', 'sans-serif']
          }
        }
      }
    };
  </script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.6.0/css/all.css">
</head>
<body class="bg-dark-bg text-text-light font-sans flex justify-center items-center h-screen">
  <div class="flex flex-col h-[90vh] w-full max-w-lg mx-auto shadow-2xl rounded-2xl overflow-hidden border border-dark-secondary bg-dark-secondary">
    <div class="bg-dark-secondary p-5 text-lg font-semibold flex items-center justify-between border-b border-text-gray">
      <span>Arum - AI Chatbot</span>
    </div>
    <div id="chat-body" class="flex-1 overflow-y-auto p-5 space-y-4 scrollbar-thin scrollbar-thumb-text-gray scrollbar-track-dark-secondary"></div>
    <form id="chat-form" class="p-4 bg-dark-secondary flex items-center gap-3 border-t border-text-gray">
      <textarea id="chat-input" class="flex-1 bg-dark-secondary border border-text-gray p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Tanyakan sesuatu..." rows="1"></textarea>
      <button type="submit" class="bg-accent text-white p-3 rounded-full transition-all hover:bg-accent-dark" disabled>
        <i class="fa-solid fa-paper-plane"></i>
      </button>
    </form>
  </div>

  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
  <script>
    $(document).ready(function() {
      let isLoading = false;

      $("#chat-input").on("input", function () {
        $(".chat-send").prop("disabled", $(this).val().trim() === "" || isLoading);
      });

      $("#chat-form").submit(function (e) {
        e.preventDefault();
        var message = $("#chat-input").val().trim();
        if (message === "" || isLoading) return;

        isLoading = true;
        $(".chat-send").prop("disabled", true);

        $("#chat-body").append("<div class='p-4 rounded-lg max-w-xs shadow-lg bg-white text-dark-bg self-end'>" + message.replace(/\n/g, "<br>") + "</div>");
        $("#chat-input").val("");
        scrollChatToBottom();

        var $botMsg = $("<div class='p-4 rounded-lg max-w-xs shadow-lg bg-accent text-dark-bg self-start'>").html("<span class='loading'><span>.</span><span>.</span><span>.</span></span>");
        $("#chat-body").append($botMsg);
        scrollChatToBottom();

        $.ajax({
          type: "POST",
          url: "https://gemininodejsaspri-production.up.railway.app/chat",
          contentType: "application/json",
          data: JSON.stringify({ chat: message, history: [] }),
          xhrFields: { withCredentials: true },
          success: function (data) {
            isLoading = false;
            $(".chat-send").prop("disabled", $("#chat-input").val().trim() === "");
            $botMsg.html(data.response.trim().replace(/\n/g, "<br>"));
            scrollChatToBottom();
          },
          error: function () {
            isLoading = false;
            $(".chat-send").prop("disabled", $("#chat-input").val().trim() === "");
            $botMsg.html("Maaf, terjadi kesalahan.");
            scrollChatToBottom();
          }
        });
      });

      function scrollChatToBottom() {
        $("#chat-body").scrollTop($("#chat-body")[0].scrollHeight);
      }
    });
  </script>
</body>
</html>
