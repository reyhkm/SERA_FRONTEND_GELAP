<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Arum - AI Chatbot</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.6.0/css/all.css">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'dark-bg': '#111827',
            'dark-secondary': '#1f2937',
            'text-light': '#f0fdfa',
            'text-gray': '#9ca3af',
            'accent': '#2dd4bf',
            'accent-dark': '#0d9488'
          },
          fontFamily: {
            serif: ['DM Serif Display', 'serif'],
            sans: ['Plus Jakarta Sans', 'sans-serif']
          }
        }
      }
    }
  </script>
  <style>
    :root {
      --vh: 1vh;
    }
    /* Reset dasar dan pengaturan tampilan */
    body, html {
      height: 100%;
      margin: 0;
      overflow: hidden;
      font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: #111827;
      color: #f0fdfa;
    }
    /* Container chat dengan tinggi dinamis */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: calc(var(--vh, 1vh) * 100);
    }
    .chat-header {
      background-color: #1f2937;
      padding: 20px 25px;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      font-family: 'DM Serif Display', serif;
      flex-shrink: 0;
    }
    .chat-body {
      flex-grow: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .chat-body::-webkit-scrollbar {
      width: 10px;
      background-color: #1f2937;
    }
    .chat-body::-webkit-scrollbar-thumb {
      background-color: #374151;
      border-radius: 5px;
    }
    .chat-body {
      scrollbar-width: thin;
      scrollbar-color: #374151 #1f2937;
    }
    .chat-footer {
      padding: 15px 20px;
      background-color: #1f2937;
      display: flex;
      gap: 15px;
      flex-shrink: 0;
      align-items: center;
    }
    .chat-input {
      flex-grow: 1;
      padding: 12px 15px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      background-color: #1f2937;
      color: #f0fdfa;
      transition: box-shadow 0.2s ease;
      resize: none;
      overflow-y: hidden;
      max-height: 150px;
    }
    .chat-input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.5);
    }
    .chat-send {
      background-color: transparent;
      border: none;
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: color 0.2s ease, transform 0.1s ease;
    }
    .chat-send:hover {
      transform: scale(1.05);
    }
    .chat-send:disabled {
      background-color: transparent;
      color: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }
    .chat-message {
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 15px;
      line-height: 1.6;
      word-break: break-word;
      max-width: 90%;
    }
    .chat-message.user {
      background-color: #ffffff;
      color: #111827;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    .chat-message.bot {
      background-color: #2dd4bf;
      color: #111827;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }
    .chat-message.bot ul,
    .chat-message.bot ol {
      list-style-position: inside;
      padding-left: 0;
      margin: 0;
      margin-bottom: 0;
    }
    .chat-message.bot .loading {
      display: inline-flex;
      align-items: center;
    }
    .chat-message.bot .loading span {
      display: inline-block;
      margin: 0 3px;
      animation: dot-bounce 1.2s infinite ease-in-out;
    }
    .chat-message.bot .loading span:nth-child(1) { animation-delay: 0s; }
    .chat-message.bot .loading span:nth-child(2) { animation-delay: 0.2s; }
    .chat-message.bot .loading span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes dot-bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <span>S E R A</span>
    </div>
    <div class="chat-body" id="chat-body">
    </div>
    <form id="chat-form" class="chat-footer">
      <textarea id="chat-input" class="chat-input" placeholder="Tanyakan sesuatu..." autocomplete="off" rows="1"></textarea>
      <button type="submit" class="chat-send" disabled>
        <i class="fa-solid fa-arrow-up"></i>
      </button>
    </form>
  </div>

  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
    // Fungsi untuk mengatur tinggi viewport dinamis
    function setVh() {
      let vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    setVh();
    window.addEventListener('resize', setVh);

    // Deteksi apakah perangkat mobile
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    $(document).ready(function() {
      let isLoading = false;

      $("#chat-input").on("input", function () {
        const inputVal = $(this).val().trim();
        $(".chat-send").prop("disabled", inputVal === "" || isLoading);
      });

      // Tangani keydown secara berbeda untuk mobile dan non-mobile
      $("#chat-input").on("keydown", function(e) {
        if (!isMobile) {
          // Pada desktop:
          if (e.key === "Enter" && e.shiftKey) {
            return; // Biarkan event untuk new line
          } else if (e.key === "Enter") {
            e.preventDefault();
            $("#chat-form").submit();
          }
        }
      });

      $("#chat-form").submit(function (e) {
        e.preventDefault();
        var message = $("#chat-input").val().trim();
        if (message === "" || isLoading) return;

        isLoading = true;
        $(".chat-send").prop("disabled", true);

        $("#chat-body").append("<div class='chat-message user'>" + message.replace(/\n/g, "<br>") + "</div>");
        $("#chat-input").val("");
        adjustTextArea();
        scrollChatToBottom();

        var $botMsg = $("<div class='chat-message bot'>").html("<span class='loading'><span>.</span><span>.</span><span>.</span></span>");
        $("#chat-body").append($botMsg);
        scrollChatToBottom();

        $.ajax({
          type: "POST",
          url: "https://gemininodejsaspri-production.up.railway.app/chat",
          contentType: "application/json",
          data: JSON.stringify({ chat: message, history: [] }),
          xhrFields: { withCredentials: true },
          success: function (data) {
            isLoading = false;
            $(".chat-send").prop("disabled", $("#chat-input").val().trim() === "");
            // Menggunakan trim() untuk menghapus spasi atau newline ekstra
$botMsg.html(
  data.response
    .replace(/\n{2,}/g, "</p><p>") // Jika ada 2+ newlines → Pisahkan ke paragraf baru
    .replace(/\n/g, "<br>") // Jika hanya 1 newline → Tambahkan <br>
);


            scrollChatToBottom();
          },
          error: function (error) {
            isLoading = false;
            $(".chat-send").prop("disabled", $("#chat-input").val().trim() === "");
            $botMsg.html("Maaf, terjadi kesalahan.");
            scrollChatToBottom();
          }
        });
      });

      function scrollChatToBottom() {
        $("#chat-body").scrollTop($("#chat-body")[0].scrollHeight);
      }

      function adjustTextArea() {
        const $input = $("#chat-input");
        $input.css("height", "auto");
        const newHeight = $input[0].scrollHeight;
        const maxHeight = parseInt($input.css("max-height"), 10);
        if(newHeight > maxHeight) {
          $input.css("height", maxHeight + "px");
          $input.css("overflow-y", "auto");
        } else {
          $input.css("height", newHeight + "px");
          $input.css("overflow-y", "hidden");
        }
      }

      $("#chat-input").on("input", adjustTextArea);
    });
  </script>
</body>
</html>
